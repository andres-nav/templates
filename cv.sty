% This theme has been heavily inspired on the Awesome-CV
% https://github.com/posquit0/Awesome-CV/tree/master

\ProvidesPackage{cv}[2025/11/26 v1.0 Template to create amazing CVs]

% **************************************************
% Class options
% **************************************************
\RequirePackage{kvoptions}
\SetupKeyvalOptions{family=cv,prefix=cv@}

\DeclareDefaultOption{
	\PassOptionsToPackage{\CurrentOption}{utils}
}

\ProcessKeyvalOptions*

\RequirePackage[hyperref, lists]{utils}
\RequirePackage{etoolbox} % For list management

% **************************************************
% Layout
% **************************************************
\RequirePackage{geometry} % To set the page layout
\geometry{left=1.2cm, right=1.2cm, top=0.8cm, bottom=1.15cm, footskip=0cm}

%% Header & Footer
\RequirePackage{fancyhdr}
\fancyhfoffset{0em} % Set offset to each header and footer
\renewcommand{\headrulewidth}{0pt} % Remove head rule
\fancyhf{} % Clear all header & footer fields
\pagestyle{fancy} % Use fancy page style

% **************************************************
% Fonts
% **************************************************
\RequirePackage{fontspec}
\setmainfont{Helvetica}

% **************************************************
% Other Packages
% **************************************************
% Needed to make fixed length table
\RequirePackage{array}
% Needed to handle text alignment
\RequirePackage{ragged2e}
% Needed to use \ifxetex-\else-\fi statement
\RequirePackage{ifxetex}
% Needed to use \if-\then-\else statement
\RequirePackage{xifthen}
% Needed to strip chars from telephone number
\RequirePackage{xstring}
% Needed for the photo ID
\RequirePackage[skins]{tcolorbox}
\RequirePackage[english]{babel}
% Needed for bibliography support
\RequirePackage[
	backend=biber,
	style=numeric,
	sorting=ydnt,       
	defernumbers=true,  
	maxbibnames=99,    
	giveninits=true,   
	doi=true,
	url=true,
	isbn=false
]{biblatex}

%-------------------------------------------------------------------------------
%                Configuration for colors
%-------------------------------------------------------------------------------
% Text colors
\colorlet{darktext}{black}
\colorlet{text}{black}
\colorlet{graytext}{black}
\colorlet{lighttext}{black}
\colorlet{sectiondivider}{black}

%-------------------------------------------------------------------------------
%                Configuration for styles
%-------------------------------------------------------------------------------
% Configure styles for each CV elements
% For fundamental structures
\newcommand*{\headernamestyle}[1]{{\fontsize{24pt}{1em}\selectfont\scshape\color{text}#1}}
\newcommand*{\headerpositionstyle}[1]{{\fontsize{9pt}{1em}\selectfont\scshape\color{accent}#1}}
\newcommand*{\headeraddressstyle}[1]{{\fontsize{9pt}{1em}\selectfont\itshape\color{lighttext}#1}}
\newcommand*{\headersocialstyle}[1]{{\fontsize{9pt}{1em}\selectfont\color{text}#1}}
\newcommand*{\headersummarystyle}[1]{{\fontsize{9pt}{1.2em}\selectfont\color{text}#1}}
\newcommand*{\footerstyle}[1]{{\fontsize{9pt}{1em}\selectfont\scshape\color{lighttext}#1}}
\newcommand*{\sectionstyle}[1]{{\fontsize{12pt}{1em}\selectfont\scshape\color{text}#1}}

% For elements of entry
\newcommand*{\entrytitlestyle}[1]{{\fontsize{11pt}{1em}\selectfont\bfseries #1}}
\newcommand*{\entrycompanystyle}[1]{{\fontsize{9pt}{1em}\selectfont #1}}
\newcommand*{\entrysummarystyle}[1]{{\fontsize{9pt}{1em}\selectfont #1}}
\newcommand*{\entrydatestyle}[1]{{\fontsize{9pt}{1em}\selectfont #1}}
\newcommand*{\entrylocationstyle}[1]{{\fontsize{9pt}{1em}\selectfont #1}}
\newcommand*{\entryurlstyle}[1]{{\fontsize{9pt}{1em}\selectfont\underline{#1}}}

% For elements of honor
\newcommand*{\honortitlestyle}[1]{{\fontsize{11pt}{1em}\bfseries\color{darktext} #1}}
\newcommand*{\honorpositionstyle}[1]{{\fontsize{9pt}{1em}\color{graytext} #1}}
\newcommand*{\honordatestyle}[1]{{\fontsize{9pt}{1em}\color{graytext} #1}}
\newcommand*{\honorlocationstyle}[1]{{\fontsize{9pt}{1em}\slshape\color{accent} #1}}

% For elements of skill
\newcommand*{\skilltypestyle}[1]{{\fontsize{9pt}{1em}\bfseries\color{darktext} #1}}
\newcommand*{\skillsetstyle}[1]{{\fontsize{9pt}{1em}\color{text} #1}}

% For hyperlinks
\newcommand*{\cvhref}[1]{\href{#1}{\entryurlstyle{More info}}}

% For bibliography entries
\newcommand*{\bibliographytitlestyle}[1]{{\fontsize{9pt}{10.8pt}\selectfont #1}}
\newcommand*{\bibliographyauthorstyle}[1]{{\fontsize{9pt}{10.8pt}\selectfont #1}}
\newcommand*{\bibliographyvenuestyle}[1]{{\fontsize{9pt}{10.8pt}\selectfont\itshape #1}}
\newcommand*{\bibliographydatestyle}[1]{{\fontsize{9pt}{10.8pt}\selectfont #1}}
\newcommand*{\bibliographyurlstyle}[1]{{\fontsize{9pt}{10.8pt}\selectfont\underline{#1}}}

%-------------------------------------------------------------------------------
%                Commands for personal information
%-------------------------------------------------------------------------------
% Define photo ID
% Usage: \photo[circle|rectangle,edge|noedge,left|right]{<path-to-image>}
\newcommand{\photo}[2][circle,edge,left]{%
	\def\@photo{#2}
	\@for\tmp:=#1\do{%
		\ifthenelse{\equal{\tmp}{circle} \or \equal{\tmp}{rectangle}}%
		{\let\@photoshape\tmp}{}%
		\ifthenelse{\equal{\tmp}{edge} \or \equal{\tmp}{noedge}}%
		{\let\@photoedge\tmp}{}%
		\ifthenelse{\equal{\tmp}{left} \or \equal{\tmp}{right}}%
		{\let\@photoalign\tmp}{}%
	}%
}
\def\@photoshape{circle}
\def\@photoedge{edge}
\def\@photoalign{left}

% Define writer's name
% Usage: \name{<firstname>}{<lastname>}
% Usage: \firstname{<firstname>}
% Usage: \lastname{<lastname>}
% Usage: \familyname{<familyname>}
\newcommand*{\name}[2]{\def\@firstname{#1}\def\@lastname{#2}}
\newcommand*{\firstname}[1]{\def\@firstname{#1}}
\newcommand*{\lastname}[1]{\def\@lastname{#1}}
\newcommand*{\familyname}[1]{\def\@lastname{#1}}
\def\@familyname{\@lastname}

% Define writer's address
% Usage: \address{<address>}
\newcommand*{\address}[1]{\def\@address{#1}}

% Define writer's position
% Usage: \position{item1, item2, item3, ...}
% Example: \position{Cloud Computing, DevOps, System Architecture}
\newcommand*{\position}[1]{%
	\def\@position{#1}%
}

% Defines social information as a list
% Usage: \social{item1, item2, item3, ...}
% Example: \social{contact@example.com, github.com/username, linkedin.com/in/username}
\newcommand*{\social}[1]{%
	\def\@sociallinks{#1}%
}

% Defines writer's summary (optional)
% Usage: \summary{<summary>}
\newcommand*{\summary}[1]{\def\@summary{#1}}

%-------------------------------------------------------------------------------
%                Commands for extra
%-------------------------------------------------------------------------------
%% Define helper macros a user can change easily
% Header
\newcommand{\headernamedelim}{\space}
\newcommand{\afternameskip}{0.2em}
\newcommand{\afterpositionskip}{0.2em}
\newcommand{\afteraddressskip}{0em}
\newcommand{\socialseparator}{\quad\textbar\quad}
\newcommand{\aftersocialskip}{0.75em}
\newcommand{\aftersummaryskip}{0em}

% Internal list for social links
\def\@sociallinks{}

% Others
\newcommand{\sectiontopskip}{0.35em}
\newcommand{\sectioncontenttopskip}{0.2em}

%-------------------------------------------------------------------------------
%                Commands for utilities
%-------------------------------------------------------------------------------
% Use to align an element of tabular table
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

% Use to execute conditional statements by checking empty string
\newcommand*{\ifempty}[3]{\ifthenelse{\isempty{#1}}{#2}{#3}}

%-------------------------------------------------------------------------------
%                Commands for elements of CV structure
%-------------------------------------------------------------------------------
% Define a header for CV
% Usage: \makecvheader
\newcommand*{\makecvheader}[1][C]{%
	\newcommand*{\drawphoto}{%
		\ifthenelse{\isundefined{\@photo}}{}{%
			\newlength{\photodim}
			\ifthenelse{\equal{\@photoshape}{circle}}%
			{\setlength{\photodim}{1.3cm}}%
			{\setlength{\photodim}{1.8cm}}%
			\ifthenelse{\equal{\@photoedge}{edge}}%
			{\def\@photoborder{darkgray}}%
			{\def\@photoborder{none}}%
			\begin{tikzpicture}%
				\node[\@photoshape, draw=\@photoborder, line width=0.3mm, inner sep=\photodim, fill overzoom image=\@photo] () {};
			\end{tikzpicture}
		}%
	}
	\newlength{\headertextwidth}
	\newlength{\headerphotowidth}
	\ifthenelse{\isundefined{\@photo}}{
		\setlength{\headertextwidth}{\textwidth}
		\setlength{\headerphotowidth}{0cm}
	}{%
		\setlength{\headertextwidth}{0.76\textwidth}
		\setlength{\headerphotowidth}{0.24\textwidth}
	}%
	\begin{minipage}[c]{\headerphotowidth}%
		\ifthenelse{\equal{\@photoalign}{left}}{\raggedright\drawphoto}{}
	\end{minipage}
	\begin{minipage}[c]{\headertextwidth}
		\vspace*{\fill}
		\ifthenelse{\equal{#1}{L}}{\raggedright}{\ifthenelse{\equal{#1}{R}}{\raggedleft}{\centering}}
		\headernamestyle{\@firstname\headernamedelim\@lastname}%
		\\[\afternameskip]%
		\ifthenelse{\isundefined{\@position}}{}{%
			\headerpositionstyle{%
				\def\@sep{}%
				\@for\@item:=\@position\do{%
					\@sep\@item%
					\def\@sep{\socialseparator}%
				}%
			}\\[\afterpositionskip]%
		}%
		\ifthenelse{\isundefined{\@address}}{}{\headeraddressstyle{\@address\\[\afteraddressskip]}}%
		\ifx\@sociallinks\@empty%
		\else%
			\headersocialstyle{%
				\def\@sep{}%
				\@for\@link:=\@sociallinks\do{%
					\@sep\@link%
					\def\@sep{\socialseparator}%
				}%
			} \\[\aftersocialskip]%
		\fi%
		\ifthenelse{\isundefined{\@summary}}{}{\raggedright\headersummarystyle{\@summary}\\[\aftersummaryskip]}%
		\vspace*{\fill}
	\end{minipage}%
	\begin{minipage}[c]{\headerphotowidth}%
		\ifthenelse{\equal{\@photoalign}{right}}{\raggedleft\drawphoto}{}
	\end{minipage}
}

% Define a footer for CV
% Usage: \makecvfooter{<left>}{<center>}{<right>}
\newcommand*{\makecvfooter}[3]{%
	\fancyfoot{}
	\fancyfoot[L]{\footerstyle{\today\ifempty{#1}{}{\socialseparator#1}}}
	\fancyfoot[C]{\footerstyle{\ifdefined\version\version\fi\ifempty{#2}{}{\socialseparator#2}}}
	\fancyfoot[R]{\footerstyle{\thepage\ifempty{#3}{}{\socialseparator#3}}}
}

% Renew the section command to add a divider
\renewcommand{\section}[1]{%
	\vspace{\sectiontopskip}
	\sectionstyle{#1}
	\vspace{-\baselineskip}
	\par\noindent\color{sectiondivider}\hrule height 1pt
}

% Define an entry of cv information
% Usage: \cventry{<position>}{<title>}{<info>}{<location>}{<date>}
\newcommand*{\cventry}[5]{%
	\vspace{\sectioncontenttopskip}%
	{%
		\entrytitlestyle{#1}%
		\hfill%
		\entrydatestyle{#5} \\%
	}%
	\ifstrempty{#2#3#4}%
	{}%
	{%
		\entrycompanystyle{#2}%
		\ifempty{#3}{}{\entrysummarystyle{{\socialseparator}#3}}%
		\hfill%
		\entrylocationstyle{#4} \\%
	}%
	\vspace{-\baselineskip}%
}

% Define an environment for cv entry with itemize
% Usage: 
% \begin{cvitemizeentry}{<position>}{<title>}{<info>}{<location>}{<date>}
%     \item First bullet point
%     \item Second bullet point
% \end{cvitemizeentry}
\newenvironment{cvitemizeentry}[5]{%
	\vspace{\sectioncontenttopskip}%
	\entrytitlestyle{#1}%
	\hfill%
	\entrydatestyle{#2}
	\newline
	\ifstrempty{#3#4#5}%
	{}%
	{%
		\entrycompanystyle{#3}%
		\ifempty{#4}{}{\entrysummarystyle{{\socialseparator}#4}}%
		\hfill%
		\entrylocationstyle{#5} 
		\newline
		\vspace{-\baselineskip}%
	}
	\begin{itemize}%
}{%
	\end{itemize}%
}

% Usage: \cvhonor{<position>}{<title>}{<url>}{<date>}
\newcommand*{\cvhonor}[4]{%
	\vspace{\sectioncontenttopskip}%
	\honortitlestyle{#1}\ifempty{#2}{}{,} \honorpositionstyle{#2}\ifempty{#4}{}{ \honordatestyle{(#4)}} & \ifempty{#3}{}{\cvhref{#3}} \\%
	\vspace{-\baselineskip}%
}

% Define an environment for cvskill
\newenvironment{cvskills}{%
	\vspace{\sectioncontenttopskip}%
	\begin{center}%
		\setlength\tabcolsep{1ex}%
		\setlength{\extrarowheight}{0pt}%
		\begin{tabular*}{\textwidth}{@{\extracolsep{\fill}} r L{\textwidth * \real{0.9}}}%
}{%
		\end{tabular*}%
	\end{center}%
}

% Define a line of cv information(skill)
% Usage: \cvskill{<type>}{<skillset>}
\newcommand*{\cvskill}[2]{%
	\skilltypestyle{#1} & \skillsetstyle{#2} \\
}

% **************************************************
% Lists
% **************************************************
\@ifpackageloaded{enumitem}{
	\setlist[itemize]{leftmargin=1em, noitemsep, itemsep=0.2em, label=\textbullet, before=\raggedright}
}{}

% **************************************************
% Bibliography Configuration
% **************************************************
% Customize biblatex formatting to match CV style
\AtBeginDocument{
	\@ifpackageloaded{biblatex}{
		% Remove "In:" before journal/booktitle
		\renewbibmacro{in:}{}
		
		% Enable URL line breaking at various points
		\setcounter{biburlnumpenalty}{100}% Allow breaking after numbers
		\setcounter{biburlucpenalty}{100}% Allow breaking after uppercase letters
		\setcounter{biburllcpenalty}{100}% Allow breaking after lowercase letters
		
		% Format bibliography entries with numeric labels [1], [2], etc.
		\defbibenvironment{bibliography}
		{\list
			{\printtext[labelnumberwidth]{%
				\printfield{labelprefix}%
				\printfield{labelnumber}}}
			{%
				\setlength{\labelwidth}{\labelnumberwidth}%
				\setlength{\leftmargin}{\labelwidth}%
				\setlength{\labelsep}{0.5em}%
				\addtolength{\leftmargin}{\labelsep}%
				\setlength{\itemindent}{0pt}%
				\setlength{\itemsep}{\sectioncontenttopskip}%
				\setlength{\parsep}{0pt}%
			}%
		}
		{\endlist}
		{\item\raggedright}
		
		% Customize field formats
		\DeclareFieldFormat[article,inproceedings,incollection,book,thesis]{title}{\bibliographytitlestyle{#1}}
		\DeclareFieldFormat[article]{journaltitle}{\bibliographyvenuestyle{#1}}
		\DeclareFieldFormat[inproceedings,incollection]{booktitle}{\bibliographyvenuestyle{#1}}
		\DeclareFieldFormat{url}{\bibliographyurlstyle{\url{#1}}}
		\DeclareFieldFormat{doi}{\bibliographyurlstyle{DOI: \href{https://doi.org/#1}{#1}}}
		
		% Remove quotes from titles
		\DeclareFieldFormat*{title}{#1}
		
		% Customize name format
		\renewcommand*{\mkbibnamegiven}[1]{\bibliographyauthorstyle{#1}}
		\renewcommand*{\mkbibnamefamily}[1]{\bibliographyauthorstyle{#1}}
		\renewcommand*{\mkbibnameprefix}[1]{\bibliographyauthorstyle{#1}}
		\renewcommand*{\mkbibnamesuffix}[1]{\bibliographyauthorstyle{#1}}
		
		% Format date
		\renewcommand*{\mkbibdatelong}[3]{\bibliographydatestyle{\iffieldundef{#1}{}{\thefield{#1}}}}
	}{}
}

% Define command to add bibliography on a new page
% Usage: \makecvbibliography{<section-title>}
% Example: \makecvbibliography{References}
% Note: You must add \addbibresource{yourfile.bib} in the preamble before \begin{document}
\newcommand*{\makecvbibliography}[1]{%
	\clearpage
	\section{#1}
	\vspace{\sectioncontenttopskip}%
	\printbibliography[heading=none]
}
